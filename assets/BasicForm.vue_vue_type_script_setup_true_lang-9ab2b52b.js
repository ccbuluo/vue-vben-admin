var Le=Object.defineProperty;var ve=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ge=(t,o,s)=>o in t?Le(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,P=(t,o)=>{for(var s in o||(o={}))$e.call(o,s)&&ge(t,s,o[s]);if(ve)for(var s of ve(o))Pe.call(o,s)&&ge(t,s,o[s]);return t};var j=(t,o,s)=>new Promise((a,A)=>{var l=c=>{try{b(s.next(c))}catch(p){A(p)}},d=c=>{try{b(s.throw(c))}catch(p){A(p)}},b=c=>c.done?a(c.value):Promise.resolve(c.value).then(l,d);b((s=s.apply(t,o)).next())});import{u as n,g as Re,c as X,w as Z,am as Ne,x as me,H as Fe,h as Se,d as Ue,J as Ce,r as be,f as Q,o as We,Z as le,a8 as we,a9 as se,l as Ve,N as re,_ as ke,aa as fe,ad as Be,ai as ue,aj as de,F as He,ac as Ie,ak as Ke}from"./vue-ea98dac5.js";import{_ as Ye}from"./FormItem.vue_vue_type_script_lang-461cbd5e.js";import{b as Xe,c as qe,_ as ze}from"./BasicForm.vue_vue_type_style_index_0_lang-77669a69.js";import{h as Ge,d as Oe,a as Je}from"./helper-ec539efd.js";import{O as Qe,Q as H,R as M,n as oe,q as ie,S as q,U as ee,V as Te,W as C,c as z,N as Ze,u as xe,X as De,Y as pe,d as _e,h as Me}from"./index.js";import{g as he}from"./get-3d19de2f.js";import{i as et}from"./isNumber-f0336cfd.js";import{i as tt}from"./isBoolean-9388e2d6.js";import{u as nt}from"./uniqBy-3d1a97d8.js";import{u as st}from"./index-ee2d8144.js";import{R as rt,y as it}from"./antd-c2e94c83.js";function Ee(t,o){return t==null?!0:Qe(t,o)}function ot(t,o,s){const a=/^\[(.+)\]$/;if(a.test(t)){const A=t.match(a);if(A&&A[1]){const l=A[1].split(",");return o=Array.isArray(o)?o:[o],l.forEach((d,b)=>{q(s,d.trim(),o[b])}),!0}}}function at(t,o,s){const a=/^\{(.+)\}$/;if(a.test(t)){const A=t.match(a);if(A&&A[1]){const l=A[1].split(",");return o=H(o)?o:{},l.forEach(d=>{q(s,d.trim(),o[d.trim()])}),!0}}}function ct({defaultValueRef:t,getSchema:o,formModel:s,getProps:a}){function A(c){var w,D;if(!H(c))return{};const p={};for(const I of Object.entries(c)){let[,f]=I;const[u]=I;if(!u||M(f)&&f.length===0||oe(f))continue;const E=n(a).transformDateFunc;H(f)&&(f=E==null?void 0:E(f)),M(f)&&((w=f[0])!=null&&w.format)&&((D=f[1])!=null&&D.format)&&(f=f.map(y=>E==null?void 0:E(y))),ie(f)&&(f===""?f=void 0:f=f.trim()),!ot(u,f,p)&&!at(u,f,p)&&q(p,u,f)}return l(p)}function l(c){const p=n(a).fieldMapToTime;if(!p||!Array.isArray(p))return c;for(const[w,[D,I],f="YYYY-MM-DD"]of p){if(!w||!D||!I)continue;if(!he(c,w)){Ee(c,w);continue}const[u,E]=he(c,w),[y,F]=Array.isArray(f)?f:[f,f];!ee(u)&&!Te(u)&&q(c,D,d(u,y)),!ee(E)&&!Te(E)&&q(c,I,d(E,F)),Ee(c,w)}return c}function d(c,p){return p==="timestamp"?C(c).unix():p==="timestampStartDay"?C(c).startOf("day").unix():C(c).format(p)}function b(){const c=n(o),p={};c.forEach(w=>{const{defaultValue:D,defaultValueObj:I}=w,f=Object.keys(I||{});f.length&&f.map(u=>{p[u]=I[u],s[u]===void 0&&(s[u]=I[u])}),ee(D)||(p[w.field]=D,s[w.field]===void 0&&(s[w.field]=D))}),t.value=z(p)}return{handleFormValues:A,initDefault:b}}const Y=24;function lt({advanceState:t,emit:o,getProps:s,getSchema:a,formModel:A,defaultValueRef:l}){const d=Re(),{realWidthRef:b,screenEnum:c,screenRef:p}=Ze(),w=X(()=>{if(!t.isAdvanced)return 0;const y=n(s).emptySpan||0;if(et(y))return y;if(H(y)){const{span:F=0}=y,_=n(p);return y[_.toLowerCase()]||F||0}return 0}),D=xe(u,30);Z([()=>n(a),()=>t.isAdvanced,()=>n(b)],()=>{const{showAdvancedButton:y}=n(s);y&&D()},{immediate:!0});function I(y,F=0,_=!1){const R=n(b),N=parseInt(y.md)||parseInt(y.xs)||parseInt(y.sm)||y.span||Y,S=parseInt(y.lg)||N,U=parseInt(y.xl)||S,L=parseInt(y.xxl)||U;return R<=c.LG?F+=N:R<c.XL?F+=S:R<c.XXL?F+=U:F+=L,_?(t.hideAdvanceBtn=!1,F<=Y*2?(t.hideAdvanceBtn=!0,t.isAdvanced=!0):F>Y*2&&F<=Y*(n(s).autoAdvancedLine||3)?t.hideAdvanceBtn=!1:t.isLoad||(t.isLoad=!0,t.isAdvanced=!t.isAdvanced),{isAdvanced:t.isAdvanced,itemColSum:F}):F>Y*(n(s).alwaysShowLines||1)?{isAdvanced:t.isAdvanced,itemColSum:F}:{isAdvanced:!0,itemColSum:F}}const f=Ne({});function u(){var R;let y=0,F=0;const{baseColProps:_={}}=n(s);for(const N of n(a)){const{show:S,colProps:U}=N;let L=!0;if(tt(S)&&(L=S),oe(S)&&(L=S({schema:N,model:A,field:N.field,values:P(P({},n(l)),A)})),L&&(U||_)){const{itemColSum:e,isAdvanced:r}=I(P(P({},_),U),y);y=e||0,r&&(F=y),f[N.field]=r}}(R=d==null?void 0:d.proxy)==null||R.$forceUpdate(),t.actionSpan=F%Y+n(w),I(n(s).actionColOptions||{span:Y},y,!0),o("advanced-change")}function E(){t.isAdvanced=!t.isAdvanced}return{handleToggleAdvanced:E,fieldsIsAdvancedMap:f}}function ft(t,o={}){const s=/^\[(.+)\]$/;if(s.test(t)){const a=t.match(s);if(a&&a[1]){const A=a[1].split(",");if(!A.length)return;const l=[];return A.forEach((d,b)=>{q(l,b,o[d.trim()])}),l.filter(Boolean).length?l:void 0}}}function ut(t,o={}){const s=/^\{(.+)\}$/;if(s.test(t)){const a=t.match(s);if(a&&a[1]){const A=a[1].split(",");if(!A.length)return;const l={};return A.forEach(d=>{q(l,d.trim(),o[d.trim()])}),Object.values(l).filter(Boolean).length?l:void 0}}}function dt({emit:t,getProps:o,formModel:s,getSchema:a,defaultValueRef:A,formElRef:l,schemaRef:d,handleFormValues:b}){function c(){return j(this,null,function*(){const{resetFunc:e,submitOnReset:r}=n(o);e&&oe(e)&&(yield e()),n(l)&&(Object.keys(s).forEach(i=>{const m=n(a).find(O=>O.field===i),g=m==null?void 0:m.defaultValueObj,B=Object.keys(g||{});B.length&&B.map(O=>{s[O]=g[O]}),s[i]=pt(m,A,i)}),me(()=>S()),t("reset",Fe(s)),r&&L())})}const p=()=>n(a).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function w(e){return j(this,null,function*(){if(Object.keys(e).length===0)return;const r=p(),v=".",i=r.filter(g=>String(g).indexOf(v)>=0),m=[];r.forEach(g=>{const B=n(a).find(T=>T.field===g);let O=he(e,g);const ae=Reflect.has(e,g);O=Ge(B==null?void 0:B.component,O);const{componentProps:G}=B||{};let $=G;typeof G=="function"&&($=$({formModel:n(s),formActionType:n(l)}));const J=ft(g,e)||ut(g,e);if(ae||J){const T=J||O;if(_(g))if(Array.isArray(T)){const W=[];for(const K of T)W.push(K?C(K):null);n(s)[g]=W}else n(s)[g]=T?$!=null&&$.valueFormat?T:C(T):null;else n(s)[g]=T;$!=null&&$.onChange&&($==null||$.onChange(T)),m.push(g)}else i.forEach(T=>{try{const W=T.split(".").reduce((K,ce)=>K[ce],e);De(W)&&(n(s)[T]=n(W),m.push(T))}catch(W){De(A.value[T])&&(n(s)[T]=z(n(A.value[T])))}})}),R(m).catch(g=>{})})}function D(e){return j(this,null,function*(){const r=z(n(a));if(!e)return;let v=ie(e)?[e]:e;ie(e)&&(v=[e]);for(const i of v)I(i,r);d.value=r})}function I(e,r){if(ie(e)){const v=r.findIndex(i=>i.field===e);v!==-1&&(delete s[e],r.splice(v,1))}}function f(e,r,v=!1){return j(this,null,function*(){const i=z(n(a)),m=Array.isArray(e)?e.map(O=>O.field):[e.field];if(i.find(O=>m.includes(O.field))){pe("There are schemas that have already been added");return}const g=i.findIndex(O=>O.field===r),B=H(e)?[e]:e;!r||g===-1||v?v?i.unshift(...B):i.push(...B):g!==-1&&i.splice(g+1,0,...B),d.value=i,y(e)})}function u(e){return j(this,null,function*(){let r=[];if(H(e)&&r.push(e),M(e)&&(r=[...e]),!r.every(i=>i.component==="Divider"||Reflect.has(i,"field")&&i.field)){pe("All children of the form Schema array that need to be updated must contain the `field` field");return}d.value=r})}function E(e){return j(this,null,function*(){let r=[];if(H(e)&&r.push(e),M(e)&&(r=[...e]),!r.every(m=>m.component==="Divider"||Reflect.has(m,"field")&&m.field)){pe("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[];n(a).forEach(m=>{let g;if(r.forEach(B=>{m.field===B.field&&(g=B)}),g!==void 0&&m.field===g.field){const B=_e(m,g);i.push(B)}else i.push(m)}),y(i),d.value=nt(i,"field")})}function y(e){let r=[];H(e)&&r.push(e),M(e)&&(r=[...e]);const v={},i=F();r.forEach(m=>{m.component!="Divider"&&Reflect.has(m,"field")&&m.field&&!ee(m.defaultValue)&&(!(m.field in i)||ee(i[m.field]))&&(v[m.field]=m.defaultValue)}),w(v)}function F(){return n(l)?b(Fe(n(s))):{}}function _(e){return n(a).some(r=>r.field===e&&r.component?Oe.includes(r.component):!1)}function R(e){return j(this,null,function*(){var v;const r=yield(v=n(l))==null?void 0:v.validateFields(e);return b(r)})}function N(e){return j(this,null,function*(){var i;let r;e===void 0?r=p():r=e===Array.isArray(e)?e:void 0;const v=yield(i=n(l))==null?void 0:i.validate(r);return b(v)})}function S(e){return j(this,null,function*(){var r;yield(r=n(l))==null?void 0:r.clearValidate(e)})}function U(e,r){return j(this,null,function*(){var v;yield(v=n(l))==null?void 0:v.scrollToField(e,r)})}function L(e){return j(this,null,function*(){e&&e.preventDefault();const{submitFunc:r}=n(o);if(r&&oe(r)){yield r();return}if(n(l))try{const i=yield N();t("submit",i)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}return{handleSubmit:L,clearValidate:S,validate:N,validateFields:R,getFieldsValue:F,updateSchema:E,resetSchema:u,appendSchemaByField:f,removeSchemaByField:D,resetFields:c,setFieldsValue:w,scrollToField:U}}function pt(t,o,s){let a=z(o.value[s]);return mt(t)?a||"":(!a&&t&&ht(t)&&(a=[0,0]),!a&&t&&t.component==="ApiTree"&&(a=[]),a)}function ht(t){if(t.component==="Slider"&&t.componentProps&&"range"in t.componentProps)return!0}function mt(t){return(t==null?void 0:t.component)&&Je.includes(t.component)}function yt(A){return j(this,arguments,function*({getSchema:t,getProps:o,formElRef:s,isInitedDefault:a}){Se(()=>j(this,null,function*(){if(n(a)||!n(o).autoFocusFirstItem)return;yield me();const l=n(t),d=n(s),b=d==null?void 0:d.$el;if(!d||!b||!l||l.length===0)return;const c=l[0];if(!c.component||!c.component.includes("Input"))return;const p=b.querySelector(".ant-row:first-child input");p&&(p==null||p.focus())}))})}const Ot=Ue({name:"BasicForm",__name:"BasicForm",props:Xe,emits:["advanced-change","reset","submit","register","field-value-change"],setup(t,{expose:o,emit:s}){const a=t,A=Ce(),l=be({}),d=st(),b=be({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),c=Q({}),p=Q(!1),w=Q(),D=Q(null),I=Q(null),{prefixCls:f}=Me("basic-form"),u=X(()=>P(P({},a),n(w))),E=X(()=>[f,{[`${f}--compact`]:n(u).compact}]),y=X(()=>{const{baseRowStyle:h={},rowProps:x}=n(u);return P({style:h},x)}),F=X(()=>P(P(P({},A),a),n(u))),_=X(()=>{const h=n(D)||n(u).schemas;for(const x of h){const{defaultValue:V,component:k,componentProps:te,isHandleDateDefaultValue:je=!0}=x;if(je&&V&&k&&Oe.includes(k)){const ne=te?te.valueFormat:null;if(!Array.isArray(V))x.defaultValue=ne?C(V).format(ne):C(V);else{const ye=[];V.forEach(Ae=>{ye.push(ne?C(Ae).format(ne):C(Ae))}),x.defaultValue=ye}}}return n(u).showAdvancedButton?z(h.filter(x=>x.component!=="Divider")):z(h)}),{handleToggleAdvanced:R,fieldsIsAdvancedMap:N}=lt({advanceState:b,emit:s,getProps:u,getSchema:_,formModel:l,defaultValueRef:c}),{handleFormValues:S,initDefault:U}=ct({getProps:u,defaultValueRef:c,getSchema:_,formModel:l});yt({getSchema:_,getProps:u,isInitedDefault:p,formElRef:I});const{handleSubmit:L,setFieldsValue:e,clearValidate:r,validate:v,validateFields:i,getFieldsValue:m,updateSchema:g,resetSchema:B,appendSchemaByField:O,removeSchemaByField:ae,resetFields:G,scrollToField:$}=dt({emit:s,getProps:u,formModel:l,getSchema:_,defaultValueRef:c,formElRef:I,schemaRef:D,handleFormValues:S});qe({resetAction:G,submitAction:L}),Z(()=>n(u).model,()=>{const{model:h}=n(u);h&&e(h)},{immediate:!0}),Z(()=>n(u).schemas,h=>{B(h!=null?h:[])}),Z(()=>_.value,h=>{me(()=>{var x;(x=d==null?void 0:d.redoModalHeight)==null||x.call(d)}),!n(p)&&h!=null&&h.length&&(U(),p.value=!0)}),Z(()=>l,xe(()=>{n(u).submitOnChange&&L()},300),{deep:!0});function J(h){return j(this,null,function*(){w.value=_e(n(w)||{},h)})}function T(h,x,V){l[h]=x,s("field-value-change",h,x),V&&V.itemProps&&!V.itemProps.autoLink&&i([h]).catch(k=>{})}function W(h){const{autoSubmitOnEnter:x}=n(u);if(x&&h.key==="Enter"&&h.target&&h.target instanceof HTMLElement){const V=h.target;V&&V.tagName&&V.tagName.toUpperCase()=="INPUT"&&L()}}const K={getFieldsValue:m,setFieldsValue:e,resetFields:G,updateSchema:g,resetSchema:B,setProps:J,removeSchemaByField:ae,appendSchemaByField:O,clearValidate:r,validateFields:i,validate:v,submit:L,scrollToField:$},ce=X(()=>P(P({},u.value),b));return o({setProps:J}),We(()=>{U(),s("register",K)}),(h,x)=>(le(),we(n(it),Ie(F.value,{class:E.value,ref_key:"formElRef",ref:I,model:l,onKeypress:Ke(W,["enter"])}),{default:se(()=>[Ve(n(rt),ue(de(y.value)),{default:se(()=>[re(h.$slots,"formHeader"),(le(!0),ke(He,null,fe(_.value,V=>(le(),we(Ye,{key:V.field,isAdvanced:n(N)[V.field],tableAction:h.tableAction,formActionType:K,schema:V,formProps:u.value,allDefaultValues:c.value,formModel:l,setFormModel:T},Be({_:2},[fe(Object.keys(h.$slots),k=>({name:k,fn:se(te=>[re(h.$slots,k,ue(de(te||{})))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Ve(ze,Ie(ce.value,{onToggleAdvanced:n(R)}),Be({_:2},[fe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],V=>({name:V,fn:se(k=>[re(h.$slots,V,ue(de(k||{})))])}))]),1040,["onToggleAdvanced"]),re(h.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"]))}});export{Ot as _};
